# ุชูุฑูุฑ ุฅุตูุงุญ ุฎุทุฃ: Runtime TypeError ูู ุตูุญุฉ ุงููุฏููุนุงุช

## ุงูุฎุทุฃ ุงูููุตุญุญ

**ููุน ุงูุฎุทุฃ:** Runtime TypeError  
**ุฑุณุงูุฉ ุงูุฎุทุฃ:** Cannot read properties of undefined (reading 'reference')  
**ุงููููุน:** `src\app\restaurant\invoices\payments\page.tsx:253:63`  
**ุงูุณุจุจ:** ูุญุงููุฉ ูุฑุงุกุฉ ุฎุตุงุฆุต ูู ูุงุฆู `payment` ุบูุฑ ููุชูู ุฃู `undefined`

## ุชุญููู ุงููุดููุฉ

ูุฐุง ูู **ุงูุฎุทุฃ ุงูุณุงุฏุณ ูู ููุณ ุงูููุน** ูู ุตูุญุงุช DataTable. ุงูุณูุณูุฉ ุงููุงููุฉ:
1. โ ุตูุญุฉ ุงููุฎุฒูู - `inventoryItem.productType` ู `movement.productName`
2. โ ุตูุญุฉ ุงูุทูุจุงุช - `order.orderNumber`
3. โ ุตูุญุฉ ุงูุชุตุงููู - `design.thumbnailUrl`
4. โ ุตูุญุฉ ุงูููุงุชูุฑ - `invoice.invoiceNumber`
5. โ ุตูุญุฉ ุงููุฏููุนุงุช - `payment.reference` โ ูุฐุง ุงูุฅุตูุงุญ

ุงูููุท ูุงุถุญ: ุฌููุน ุตูุญุงุช DataTable ุชุญุชุงุฌ ูููุณ ุงูุญูุงูุฉ ูู ุงูุจูุงูุงุช ุบูุฑ ุงูููุชููุฉ.

## ุงูุฅุตูุงุญุงุช ุงูููููุฐุฉ

### 1. ุนููุฏ ุงููุฏููุนุฉ (Payment Column)
```typescript
// ูุจู ุงูุฅุตูุงุญ:
<div>{payment.reference}</div>
<div>ูุงุชูุฑุฉ: {payment.invoiceNumber}</div>
<div>{formatDate(payment.paidAt)}</div>

// ุจุนุฏ ุงูุฅุตูุงุญ:
<div>{payment?.reference || 'ุบูุฑ ูุญุฏุฏ'}</div>
<div>ูุงุชูุฑุฉ: {payment?.invoiceNumber || 'ุบูุฑ ูุญุฏุฏ'}</div>
<div>{payment?.paidAt ? formatDate(payment.paidAt) : 'ุบูุฑ ูุญุฏุฏ'}</div>
```

### 2. ุนููุฏ ุงููุจูุบ (Amount Column)
```typescript
// ูุจู ุงูุฅุตูุงุญ:
{formatCurrency(payment.amount)}

// ุจุนุฏ ุงูุฅุตูุงุญ:
{formatCurrency(payment?.amount || 0)}
```

### 3. ุนููุฏ ุทุฑููุฉ ุงูุฏูุน (Method Column)
```typescript
// ูุจู ุงูุฅุตูุงุญ:
{getMethodIcon(payment.method)}
{getMethodText(payment.method)}
{payment.bankDetails && <div>{payment.bankDetails.bankName}</div>}

// ุจุนุฏ ุงูุฅุตูุงุญ:
{getMethodIcon(payment?.method || 'unknown')}
{getMethodText(payment?.method || 'unknown')}
{payment?.bankDetails && <div>{payment.bankDetails.bankName || 'ุบูุฑ ูุญุฏุฏ'}</div>}
```

### 4. ุนููุฏ ุงูุญุงูุฉ (Status Column)
```typescript
// ูุจู ุงูุฅุตูุงุญ:
{getStatusColor(payment.status)}
{getStatusText(payment.status)}

// ุจุนุฏ ุงูุฅุตูุงุญ:
{getStatusColor(payment?.status || 'unknown')}
{getStatusText(payment?.status || 'unknown')}
```

### 5. ุนููุฏ ุงูุฅุฌุฑุงุกุงุช (Actions Column)
```typescript
// ูุจู ุงูุฅุตูุงุญ:
onClick={() => router.push(`/restaurant/invoices/${payment.invoiceId}`)}
onClick={() => window.open(`/api/payments/${payment.id}/receipt`)}

// ุจุนุฏ ุงูุฅุตูุงุญ:
onClick={() => router.push(`/restaurant/invoices/${payment?.invoiceId || ''}`)}
disabled={!payment?.invoiceId}
onClick={() => window.open(`/api/payments/${payment?.id || ''}/receipt`)}
disabled={!payment?.id}
```

### 6. ุชุญุฏูุซ ุงูุฏูุงู ุงููุณุงุนุฏุฉ

#### ุฏุงูุฉ getStatusColor:
```typescript
case 'unknown': return 'bg-gray-100 text-gray-600'
```

#### ุฏุงูุฉ getStatusText:
```typescript
case 'unknown': return 'โ ุบูุฑ ูุญุฏุฏ'
```

#### ุฏุงูุฉ getMethodIcon:
```typescript
case 'unknown': return 'โ'
```

#### ุฏุงูุฉ getMethodText:
```typescript
case 'unknown': return 'ุบูุฑ ูุญุฏุฏ'
```

## ุงูุฃุนูุฏุฉ ุงูููุตุญุญุฉ

โ **ุนููุฏ ุงููุฏููุนุฉ** - payment info (reference, invoiceNumber, paidAt)  
โ **ุนููุฏ ุงููุจูุบ** - amount info (amount)  
โ **ุนููุฏ ุทุฑููุฉ ุงูุฏูุน** - method info (method, bankDetails)  
โ **ุนููุฏ ุงูุญุงูุฉ** - status info (status)  
โ **ุนููุฏ ุงูุฅุฌุฑุงุกุงุช** - actions (view invoice, download receipt)  

## ุทุฑู ุงูุฏูุน ุงููุฏุนููุฉ

| ุงูุทุฑููุฉ | ุงูุฃููููุฉ | ุงููุต |
|---------|--------|-----|
| `bank_transfer` | ๐ฆ | ุชุญููู ุจููู |
| `cash` | ๐ฐ | ููุฏู |
| `check` | ๐ | ุดูู |
| `unknown` | โ | ุบูุฑ ูุญุฏุฏ |

## ุญุงูุงุช ุงููุฏููุนุงุช

| ุงูุญุงูุฉ | ุงูุฃููููุฉ | ุงูููู |
|-------|--------|--------|
| `completed` | โ | ุฃุฎุถุฑ |
| `pending` | โณ | ุฃุตูุฑ |
| `failed` | โ | ุฃุญูุฑ |
| `cancelled` | ๐ซ | ุฑูุงุฏู |
| `unknown` | โ | ุฑูุงุฏู ูุงุชุญ |

## ุงูุญูุงูุฉ ุงูููุถุงูุฉ

- โ ุญูุงูุฉ ูู `undefined` properties ูู ุฌููุน ุงูุฃุนูุฏุฉ
- โ ููู ุงูุชุฑุงุถูุฉ ููุงุณุจุฉ (0 ูููุจุงูุบุ 'ุบูุฑ ูุญุฏุฏ' ูููุตูุต)
- โ ุชุนุทูู ุงูุฃุฒุฑุงุฑ ุนูุฏ ุนุฏู ูุฌูุฏ ูุนุฑูุงุช ุตุงูุญุฉ
- โ ุญูุงูุฉ ูู ุฏูุงู ุงูุชููู ูุชุญููู ุงูุฅูุตุงูุงุช
- โ ุญูุงูุฉ ูู ุชูุงุตูู ุงูุจูู ุนูุฏ ุนุฑุถูุง

## ุงูุฅูุฌุงุฒ ุงูุชุฑุงููู

### โ ุงูุตูุญุงุช ุงููุญููุฉ ุงูุขู:
1. **ุงููุฎุฒูู** - `inventory/page.tsx` (2 ุฌุฏุงูู)
2. **ุงูุทูุจุงุช** - `orders/page.tsx`
3. **ุงูุชุตุงููู** - `designs/page.tsx`
4. **ุงูููุงุชูุฑ** - `invoices/page.tsx`
5. **ุงููุฏููุนุงุช** - `invoices/payments/page.tsx`

### ๐ก๏ธ ุงูููุท ุงูููุญุฏ ุงูููุทุจู:
- ูุญุต ุขูุงู ุจู `?.` ูุฌููุน ุงูุฎุตุงุฆุต
- ููู ุงูุชุฑุงุถูุฉ ููุงุณุจุฉ ููู ููุน ุจูุงูุงุช
- ุชุนุทูู ุงูุฃุฒุฑุงุฑ ุนูุฏ ุนุฏู ูุฌูุฏ ูุนุฑูุงุช
- ุฏุนู ุญุงูุฉ 'unknown' ูู ุฌููุน ุงูุฏูุงู ุงููุณุงุนุฏุฉ
- ุฑุณุงุฆู ุนุฑุจูุฉ ูุงุถุญุฉ ููุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ

## ุงููุชูุฌุฉ

โ **ุชู ุฅุถุงูุฉ ุตูุญุฉ ุฎุงูุณุฉ ููุญูุงูุฉ ุงูุดุงููุฉ**

ุงูุขู **5 ุตูุญุงุช ุฑุฆูุณูุฉ** ูุญููุฉ ุจุงููุงูู ุถุฏ:
- ูุงุฆูุงุช ุงูุจูุงูุงุช ุบูุฑ ุงูููุชููุฉ
- ุงูุฎุตุงุฆุต ุงูููููุฏุฉ ุฃู `undefined`
- ุงูุชููู ุจุฏูู ูุนุฑูุงุช ุตุงูุญุฉ
- ุนุฑุถ ุงูุจูุงูุงุช ุงููุงููุฉ ุงูููููุฏุฉ
- ุทุฑู ูุญุงูุงุช ุฏูุน ุบูุฑ ูุนุฑููุฉ

## ุงูุงุฎุชุจุงุฑ ุงููุทููุจ

1. ุชุดุบูู ุงูุชุทุจูู ูุงูุชููู ุฅูู ุตูุญุฉ ุงููุฏููุนุงุช: `/restaurant/invoices/payments`
2. ุงูุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุฃุฎุทุงุก console
3. ุงูุชุญูู ูู ุนุฑุถ ุฌููุน ุงูุฃุนูุฏุฉ ุจุดูู ุตุญูุญ
4. ุงุฎุชุจุงุฑ ุงูููุงุชุฑ (ุทุฑููุฉ ุงูุฏูุนุ ุงูุจุญุซ)
5. ุงุฎุชุจุงุฑ ุงูุฃุฒุฑุงุฑ (ูุฌุจ ุฃู ุชููู ูุนุทูุฉ ููุจูุงูุงุช ุบูุฑ ุงูุตุงูุญุฉ)
6. ูุญุงููุฉ ุชุญููู ุงูุฅูุตุงูุงุช ูุนุฑุถ ุงูููุงุชูุฑ

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 20 ุณุจุชูุจุฑ 2025  
**ุงูููุตุญุญ:** ุชุฑุณ ุงูุดูุฑุฉ-1  
**ุงูุญุงูุฉ:** ููุชูู โ  
**ุงูุฅูุฌุงุฒ:** 5 ุตูุญุงุช ูุญููุฉุ ุงูููุท ูุชูุณุน ุชุฏุฑูุฌูุงู
